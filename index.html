<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Ein Schulprojekt fÃ¼r unsere Schule.">
  <meta name="author" content="foodNtaste">
  <style>
    h1 {
      color: #ffd700;
      text-align: center;
      font-size: 40px;
      font-family: Sans-Serif;
    }

    h2 {
      color: inherit;
      text-align: center;
      font-size: 20px;
      font-family: sans-serif;
    }

    table {
      font-family: sans-serif;
    }

    th {
      color: FF0000;
    }

    #chart_div {
      padding-left: 33%;
    }
  </style>
  <!--Load the AJAX API-->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript">

    // Load the Visualization API and the piechart package.
    google.charts.load('current', { 'packages': ['corechart'] });

    // Set a callback to run when the Google Visualization API is loaded.
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      $.ajax({
        url: "getData.php",
        dataType: "json",
      }).done(function (jsonData) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Bewertung');
        data.addColumn('number', 'bewertung');

        // count ratings for each rating in jsondata
        var ratings = {};
        for (var i = 0; i < jsonData.length; i++) {
          var rating = jsonData[i].bewertung;
          if (ratings[rating] == undefined) {
            ratings[rating] = 1;
          } else {
            ratings[rating]++;
          }
        }

        // add ratings to data
        for (var rating in ratings) {
          data.addRow([rating, ratings[rating]]);
        }

        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
        var options = {
          title: 'Essensbewertung',
          backgroundColor: '#3b4d61',
          colors: ['green', 'yellow', 'red'],
          width: 800,
          height: 600,
          pieSliceTextStyle: { color: 'black' }
        };
        chart.draw(data, options);
      }).fail(function (jq, text, err) {
        console.log(text + ' - ' + err);
      });
    }
    setInterval(drawChart, 30000);
  </script>
</head>

<body style="background-color: #3b4d61;">
  <h1>Essensbewertung</h1>
  <h2>Bewertungen der letzten 30 Tage</h2>
  <div id="chart_div"></div>
</body>

</html>